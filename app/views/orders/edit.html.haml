-if notice
  %p.alert.alert-dismissible.alert-success#notice= notice

.panel.panel-info
  .panel-heading
    %h2.panel-title 注文画面
  .panel-body
    %table.table.table-striped.table-hover
      %thead
        %tr
          %th 商品名
          %th 画像
          %th 価格
          %th 数量

      %tbody
        - @order.line_items.includes(:product).each do |line_item|
          %tr
            %td= line_item.product.name
            %td= image_tag(line_item.product.img_filename, class: 'img-thumbnail', alt: "#{line_item.product.name}", size: "100x100")
            %td= line_item.product.price
            %td= line_item.quantity

    .panel.panel-warning
      .panel-heading
        %h2.panel-title 料金明細
      .panel-body
        %table.table.table-striped.table-hover
          %thead
            %tr
              %th 商品料金
              %th 数量
              %th 配送料
              %th 代引き手数料
              %th 小計
              %th 税金
              %th 合計
              %th

          %tbody
            %tr
              %td= number_to_currency(@order.item_total, locale: :ja)
              %td= @order.item_count
              %td= number_to_currency(@order.shipment_total, locale: :ja)
              %td= number_to_currency(@order.payment_total, locale: :ja)
              %td= number_to_currency(@order.adjustment_total, locale: :ja)
              %td= number_to_currency(@order.tax_total, locale: :ja)
              %td= number_to_currency(@order.total, locale: :ja)

    .panel.panel-danger
      .panel-heading
        %h2.panel-title 配送先と配送日時を指定して注文ボタンをクリックしてください
      .panel-body
        = simple_form_for(@order, url: cart_path, html: {class: 'form-horizontal'}, defaults: { wrapper_html: { class: 'col-lg-12' } }) do |f|
          = f.error_notification

          = f.hidden_field :id
          = f.hidden_field :item_count
          = f.hidden_field :item_total
          = f.hidden_field :shipment_total
          = f.hidden_field :payment_total
          = f.hidden_field :adjustment_total
          = f.hidden_field :tax_total
          = f.hidden_field :total
          .col-lg-12
            = f.input :user_name, input_html: { value: f.object.user_name || current_user.name }
            = f.input :user_zipcode, input_html: { value: f.object.user_zipcode || current_user.zipcode }
            = f.input :user_address, input_html: { value: f.object.user_address || current_user.address }
          .col-lg-12
            = f.input :shipping_date, as: :string, input_html: {"data-datepicker-options" => @order.available_shipping_date_range.to_json }
          .col-lg-12
            = f.input :shipping_time_range, as: :select, collection: Order.shipping_time_ranges.map { |k, v| [ApplicationController.helpers.t("enums.order.shipping_time_range.#{k}"), k] }, include_blank: false
          .col-lg-12
            = f.input :point_total, input_html: { value: f.object.point_total }
          .col-lg-12
            = f.button :submit, '注文する'
          = f.fields_for :line_items do |line_item|
            = line_item.hidden_field :id
            = line_item.hidden_field :product_id
            = line_item.hidden_field :quantity
            = line_item.hidden_field :price, value: @order.line_items.includes(:product)[line_item.index].product.price
